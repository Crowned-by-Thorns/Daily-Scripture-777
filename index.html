<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scripture of the Day</title>
  <meta name="description" content="A warm page that shares a Bible verse with a plain-English explanation.">
  <style>
    /* ---------- Page + background ---------- */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: #2b2118;
      background-color: #f5e9d4;
      background-image: url('assets/bg.jpg'); /* your cross background */
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-size: cover;
    }

    /* ---------- Header ---------- */
    header {
      position: sticky; top: 0; z-index: 10;
      background: rgba(255, 255, 255, 0.65);
      border-bottom: 1px solid #eadfcd;
      padding: 10px 12px;
      display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center;
      backdrop-filter: blur(3px);
    }
    h1 { margin: 0; color: #a86b3d; font-size: 18px; letter-spacing: .2px; white-space: nowrap; }

    /* ---------- Search ---------- */
    .search-wrap { position: relative; }
    .search {
      width: 100%;
      border: 1px solid #e5d6c2; background: #fff;
      padding: 10px 12px; border-radius: 12px; font-size: 14px;
      box-shadow: 0 1px 0 #f5ece0 inset;
    }
    .results {
      position: absolute; left: 0; right: 0; top: calc(100% + 6px);
      background: rgba(255,255,255,0.95);
      border: 1px solid #eadfcd; border-radius: 12px;
      box-shadow: 0 18px 40px rgba(0,0,0,.15);
      max-height: 50vh; overflow: auto; display: none;
    }
    .results.show { display: block; }
    .hit { padding: 10px 12px; border-bottom: 1px solid #f0e6d7; cursor: pointer; }
    .hit:last-child { border-bottom: 0; }
    .hit:hover, .hit.active { background: #fff7ea; }
    .hit .ref { color: #a86b3d; font-weight: 600; }
    .hit .snippet { font-size: 13px; color: #5b4a3e; margin-top: 2px; }

    /* ---------- Buttons ---------- */
    .btns { display: flex; gap: 8px; }
    button {
      margin: 0;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #e5d6c2;
      background: #fff;
      box-shadow: 0 1px 0 #f5ece0 inset;
      color: #2b2118;
      font-size: 14px;
    }
    button:hover { background: #fff7ea; cursor: pointer; }

    /* ---------- Verse card (bubble) ---------- */
    .card {
      background: rgba(255, 250, 241, 0.85);
      border-radius: 14px;
      box-shadow: 0 20px 48px rgba(0,0,0,.18), inset 0 0 1px #eadfcd;
      max-width: 800px;
      padding: 20px;
      margin: clamp(220px, 60vh, 360px) auto 18px;
      backdrop-filter: blur(4px);
      animation: fade-in 500ms ease-out both;
    }

    /* ---------- Explanation card ---------- */
    .explain {
      background: rgba(255, 255, 255, 0.88);
      border-radius: 14px;
      box-shadow: 0 16px 36px rgba(0,0,0,.12), inset 0 0 1px #eadfcd;
      max-width: 800px;
      padding: 18px;
      margin: 12px auto 40px;
      backdrop-filter: blur(3px);
      animation: fade-in 600ms ease-out both;
    }
    .explain .label { color:#8b7663; font-weight:600; margin-bottom:8px; }
    .explain .content { font-size: 18px; line-height: 1.7; }

    /* ---------- Small / Tall screens ---------- */
    @media (max-width: 420px) {
      .card { margin-top: clamp(170px, 56vh, 310px); }
      .explain .content { font-size: 17px; }
      header { grid-template-columns: 1fr; }
      .btns { justify-content: flex-end; }
    }
    @media (min-height: 900px) { .card { margin-top: clamp(280px, 62vh, 420px); } }

    /* ---------- Desktop tweaks ---------- */
    @media (min-width: 1024px) {
      body { background-position: center 32%; }
      .card { margin-top: clamp(300px, 68vh, 520px); max-width: 840px; }
      .explain { max-width: 840px; }
    }
    @media (min-aspect-ratio: 16/10) and (min-width: 1200px) {
      .card { margin-top: clamp(340px, 72vh, 560px); }
    }

    /* ---------- Typography ---------- */
    .ref  { color: #a86b3d; font-weight: 600; }
    .text { font-size: 22px; line-height: 1.6; background:#ffefb8; padding:12px; border-radius:10px; }
    @media (max-width: 420px) { .text { font-size: 20px; } }

    /* ---------- Effects ---------- */
    @keyframes fade-in { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @media (prefers-reduced-motion: reduce) { .card, .explain { animation: none; } }
  </style>
</head>
<body>
  <header>
    <h1>Scripture of the Day</h1>

    <!-- Search -->
    <div class="search-wrap">
      <input id="q" class="search" type="search" placeholder="Search: John 3:16 or words like 'shepherd peace'â€¦" autocomplete="off" />
      <div id="results" class="results" role="listbox" aria-label="Search results"></div>
    </div>

    <div class="btns">
      <button id="againBtn" aria-label="Another verse">âŸ³ Another verse</button>
      <button id="speakBtn" aria-label="Replay">ðŸ”Š Replay</button>
    </div>
  </header>

  <main>
    <!-- Main verse -->
    <section class="card" aria-live="polite">
      <div class="ref" id="ref"></div>
      <div class="text" id="text"></div>
    </section>

    <!-- Explanation -->
    <section class="explain" id="explainBox">
      <div class="label">What this means</div>
      <div class="content" id="explainText"></div>
    </section>
  </main>

  <script>
    /* ===================== Built-in verses (KJV) + explanations ===================== */
    // Add/remove entries here. Book, chapter, verse are strings so search is easy.
    const VERSES = [
      {
        book: "John", chapter: "3", verse: "16",
        text: "For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.",
        explain: "Godâ€™s love is so great that He gave Jesus for us. Anyone who trusts in Jesus is rescued from spiritual death and given eternal life with God."
      },
      {
        book: "Psalms", chapter: "23", verse: "1",
        text: "The LORD is my shepherd; I shall not want.",
        explain: "God cares for me like a perfect shepherd. Because He provides and guides, I lack nothing I truly need."
      },
      {
        book: "Psalms", chapter: "23", verse: "4",
        text: "Yea, though I walk through the valley of the shadow of death, I will fear no evil: for thou art with me; thy rod and thy staff they comfort me.",
        explain: "Even in dark and threatening times, I donâ€™t have to be afraid. God is with me and protects me, and His presence steadies my heart."
      },
      {
        book: "Proverbs", chapter: "3", verse: "5",
        text: "Trust in the LORD with all thine heart; and lean not unto thine own understanding.",
        explain: "Place your full confidence in God instead of relying only on your limited perspective."
      },
      {
        book: "Proverbs", chapter: "3", verse: "6",
        text: "In all thy ways acknowledge him, and he shall direct thy paths.",
        explain: "Invite God into every part of life. As you look to Him, He will guide your steps on the right path."
      },
      {
        book: "Jeremiah", chapter: "29", verse: "11",
        text: "For I know the thoughts that I think toward you, saith the LORD, thoughts of peace, and not of evil, to give you an expected end.",
        explain: "Godâ€™s heart toward His people is good. His plans aim to bring peace, hope, and a future under His care."
      },
      {
        book: "Romans", chapter: "8", verse: "28",
        text: "And we know that all things work together for good to them that love God, to them who are the called according to his purpose.",
        explain: "For those who love God, He is at work in every situationâ€”good or badâ€”bringing about ultimate good according to His purpose."
      },
      {
        book: "Philippians", chapter: "4", verse: "6",
        text: "Be careful for nothing; but in every thing by prayer and supplication with thanksgiving let your requests be made known unto God.",
        explain: "Donâ€™t live in anxiety. Bring everything to God in prayer with gratitude, and tell Him what you need."
      },
      {
        book: "Philippians", chapter: "4", verse: "7",
        text: "And the peace of God, which passeth all understanding, shall keep your hearts and minds through Christ Jesus.",
        explain: "God gives a deep peace that doesnâ€™t always make sense to us. That peace guards our hearts and minds in Christ."
      },
      {
        book: "Philippians", chapter: "4", verse: "13",
        text: "I can do all things through Christ which strengtheneth me.",
        explain: "With Christ giving me strength, I can face whatever He calls me toâ€”content and steady in every circumstance."
      },
      {
        book: "Isaiah", chapter: "41", verse: "10",
        text: "Fear thou not; for I am with thee: be not dismayed; for I am thy God: I will strengthen thee; yea, I will help thee; yea, I will uphold thee with the right hand of my righteousness.",
        explain: "Do not be afraidâ€”God is present, strengthening and helping you. He holds you up with His strong, faithful hand."
      }
    ];

    /* ===================== Helper functions ===================== */
    function refString(r){ return `${r.book} ${r.chapter}:${r.verse}`; }
    function pickRandom(a){ return a[Math.floor(Math.random()*a.length)]; }

    // Parse "John 3:16" style queries
    function parseRefQuery(s) {
      const m = s.trim().match(/^([1-3]?\s*[A-Za-z]+)\s+(\d+):(\d+)$/);
      return m ? { book: m[1].replace(/\s+/g,' ').trim(), chapter: m[2], verse: m[3] } : null;
    }

    /* ===================== Speech (US female) ===================== */
    const PREFERRED_NAMES = ['Samantha','Google US English','Microsoft Aria','Microsoft Jenny','Microsoft Zira','Allison','Joanna'];
    let chosenVoice = null;

    function pickVoice() {
      const voices = window.speechSynthesis.getVoices() || [];
      for (const name of PREFERRED_NAMES) {
        const v = voices.find(v => (v.name || '').toLowerCase().includes(name.toLowerCase()) &&
                                   (v.lang || '').toLowerCase().startsWith('en-us'));
        if (v) return v;
      }
      const enUSFemale = voices.find(v => (v.lang || '').toLowerCase().startsWith('en-us') &&
        /female|samantha|aria|jenny|zira|allison|joanna/i.test(v.name || ''));
      if (enUSFemale) return enUSFemale;
      const enUS = voices.find(v => (v.lang || '').toLowerCase().startsWith('en-us'));
      if (enUS) return enUS;
      const enFemale = voices.find(v => /en(-|_|$)/i.test(v.lang || '') &&
        /female|samantha|aria|jenny|zira|allison|joanna|karen|victoria/i.test(v.name || ''));
      if (enFemale) return enFemale;
      const anyEn = voices.find(v => /en(-|_|$)/i.test(v.lang || ''));
      return anyEn || voices[0] || null;
    }
    function ensureVoices(thenSpeakText) {
      const tryLoad = () => {
        const list = window.speechSynthesis.getVoices();
        if (!list || list.length === 0) return false;
        chosenVoice = pickVoice();
        if (thenSpeakText) speak(thenSpeakText);
        return true;
      };
      if (!tryLoad()) {
        const iv = setInterval(() => { if (tryLoad()) clearInterval(iv); }, 120);
        window.speechSynthesis.onvoiceschanged = () => { if (tryLoad()) window.speechSynthesis.onvoiceschanged = null; };
      }
    }
    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'en-US'; u.rate = 0.96; u.pitch = 1.03;
      if (chosenVoice) u.voice = chosenVoice;
      window.speechSynthesis.speak(u);
    }

    /* ===================== Page logic ===================== */
    let current = null;
    const q = document.getElementById('q');
    const results = document.getElementById('results');

    function showVerse(r) {
      document.getElementById('ref').textContent  = refString(r);
      document.getElementById('text').textContent = r.text;
      document.getElementById('explainText').textContent = r.explain || 'Explanation coming soon.';
      current = r;

      setTimeout(() => { if (!chosenVoice) ensureVoices(r.text); else speak(r.text); }, 150);
    }

    async function rollRandom() {
      showVerse(pickRandom(VERSES));
      history.replaceState(null,'','#');
    }

    /* ===================== Search (over the 10 entries) ===================== */
    function clearResults(){ results.innerHTML = ''; results.classList.remove('show'); activeIndex = -1; }
    function renderResults(items) {
      results.innerHTML = '';
      items.slice(0, 30).forEach((r, i) => {
        const div = document.createElement('div');
        div.className = 'hit';
        div.setAttribute('role','option');
        div.dataset.index = i;
        div.innerHTML = `<div class="ref">${refString(r)}</div>
                         <div class="snippet">${r.text.replace(/</g,'&lt;')}</div>`;
        div.addEventListener('click', () => { clearResults(); showVerse(r); q.blur(); });
        results.appendChild(div);
      });
      results.classList.toggle('show', items.length > 0);
      activeIndex = -1;
    }
    function searchVerses(query) {
      const refQ = parseRefQuery(query);
      if (refQ) {
        return VERSES.filter(v =>
          v.book.toLowerCase() === refQ.book.toLowerCase() &&
          v.chapter === String(refQ.chapter) &&
          v.verse   === String(refQ.verse)
        );
      }
      const terms = query.toLowerCase().trim().split(/\s+/).filter(Boolean);
      if (!terms.length) return [];
      return VERSES.filter(v => {
        const hay = (refString(v) + ' ' + v.text + ' ' + (v.explain||'')).toLowerCase();
        return terms.every(t => hay.includes(t));
      });
    }

    /* results keyboard nav */
    let activeIndex = -1;
    function onQueryInput() {
      const query = q.value.trim();
      if (query.length < 2) { clearResults(); return; }
      renderResults(searchVerses(query));
    }
    q.addEventListener('input', onQueryInput);
    q.addEventListener('focus', onQueryInput);
    q.addEventListener('keydown', (e) => {
      const items = Array.from(results.querySelectorAll('.hit'));
      if (!items.length) return;
      if (e.key === 'ArrowDown') { e.preventDefault(); activeIndex = (activeIndex + 1) % items.length; }
      else if (e.key === 'ArrowUp') { e.preventDefault(); activeIndex = (activeIndex - 1 + items.length) % items.length; }
      else if (e.key === 'Enter') { e.preventDefault(); (items[activeIndex] || items[0])?.click(); }
      else if (e.key === 'Escape') { clearResults(); q.blur(); }
      items.forEach(el => el.classList.remove('active'));
      if (activeIndex >= 0) items[activeIndex].classList.add('active');
    });
    document.addEventListener('click', (e) => { if (!results.contains(e.target) && e.target !== q) clearResults(); });

    /* ===================== Init ===================== */
    async function init() {
      ensureVoices();
      await rollRandom();
      document.getElementById('againBtn').addEventListener('click', rollRandom);
      document.getElementById('speakBtn').addEventListener('click', () => current && speak(current.text));
    }
    init();
  </script>
</body>
</html>
