<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Scripture</title>
  <meta name="description" content="A warm, simple page that shares a Bible verse with a plain-English explanation, search, and gentle narration." />
  <meta name="color-scheme" content="light only">
  <meta name="theme-color" content="#f5e9d4">
  <style>
    :root{
      --ink:#2b2118;
      --parch:#fffaf1;
      --parch2:#ffefb8;
      --head:#a86b3d;
      --line:#eadfcd;
      --frost:rgba(255,255,255,.72);
      --frost2:rgba(255,255,255,.88);
      --shadow:0 20px 48px rgba(0,0,0,.18);
    }

    /* Page + background */
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color:var(--ink);
      background:#f5e9d4 url('assets/bg.jpg') center / cover no-repeat fixed;
      text-rendering:optimizeLegibility;
    }

    /* Header */
    header{
      position:sticky; top:0; z-index:10;
      display:grid; grid-template-columns:auto 1fr auto; gap:.75rem; align-items:center;
      padding:10px 12px;
      background:rgba(255,255,255,.62);
      backdrop-filter: blur(3px);
      border-bottom:1px solid var(--line);
    }
    h1{
      margin:0;
      font-size:20px; font-weight:800; letter-spacing:.4px;
      background:linear-gradient(90deg,#a86b3d,#d49a6a);
      -webkit-background-clip:text; background-clip:text;
      -webkit-text-fill-color:transparent;
      text-shadow:0 2px 4px rgba(0,0,0,.15);
      white-space:nowrap;
    }

    /* Search */
    .search-wrap{position:relative}
    .search{
      width:100%;
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px; border-radius:12px; font-size:14px;
      box-shadow:0 1px 0 #f5ece0 inset;
      outline:none;
    }
    .search:focus{box-shadow:0 0 0 3px rgba(212,154,106,.25) inset}
    .results{
      position:absolute; left:0; right:0; top:calc(100% + 6px);
      background:rgba(255,255,255,.97);
      border:1px solid var(--line); border-radius:12px;
      box-shadow:0 18px 40px rgba(0,0,0,.15);
      max-height:50vh; overflow:auto; display:none;
    }
    .results.show{display:block}
    .hit{padding:10px 12px; border-bottom:1px solid #f0e6d7; cursor:pointer}
    .hit:last-child{border-bottom:0}
    .hit:hover,.hit.active{background:#fff7ea}
    .hit .ref{color:var(--head); font-weight:700}
    .hit .snippet{font-size:13px; color:#5b4a3e; margin-top:2px}
    mark{background:#fff0a6; padding:0 .1em}

    /* Buttons / toggles */
    .btns{display:flex; gap:.5rem; align-items:center}
    button{
      margin:0; padding:10px 14px; font-size:14px;
      border-radius:12px; border:1px solid #e5d6c2; background:#fff; color:var(--ink);
      box-shadow:0 1px 0 #f5ece0 inset;
    }
    button:hover{background:#fff7ea; cursor:pointer}
    .toggle{
      display:inline-flex; align-items:center; gap:.35rem; font-size:13px; user-select:none
    }
    .toggle input{accent-color:#d49a6a; width:18px; height:18px}

    /* Verse card */
    .card{
      background:rgba(255,250,241,.86);
      border-radius:16px;
      box-shadow:var(--shadow), inset 0 0 1px var(--line);
      max-width:860px; padding:22px;
      margin:clamp(220px,60vh,360px) auto 14px;
      backdrop-filter: blur(4px);
      animation:fade-in .5s ease-out both;
    }
    .ref{color:var(--head); font-weight:800; letter-spacing:.2px}
    .text{
      font-size:22px; line-height:1.6; background:var(--parch2);
      padding:12px; border-radius:12px; margin-top:6px;
    }

    /* Explanation card */
    .explain{
      background:var(--frost2);
      border-radius:16px;
      box-shadow:0 16px 36px rgba(0,0,0,.12), inset 0 0 1px var(--line);
      max-width:860px; padding:18px; margin:12px auto 40px;
      backdrop-filter: blur(3px);
      animation:fade-in .6s ease-out both;
    }
    .explain .label{color:#8b7663; font-weight:800; margin-bottom:8px; letter-spacing:.2px}
    .explain .content{font-size:18px; line-height:1.7}

    /* Tips / loading */
    .tip{
      text-align:center; font-size:13px; color:#6b5a4e; margin-top:6px;
      text-shadow:0 1px 0 rgba(255,255,255,.5)
    }
    .skeleton{
      background:linear-gradient(90deg,rgba(255,255,255,.6),rgba(255,255,255,.85),rgba(255,255,255,.6));
      background-size:200% 100%; animation:shimmer 1.2s linear infinite;
      border-radius:12px; height:3em
    }

    /* Responsive */
    @media (max-width: 520px){
      header{grid-template-columns:1fr}
      .btns{justify-content:flex-end}
      .text{font-size:20px}
      .card{margin-top:clamp(170px,56vh,310px)}
    }
    @media (min-height:900px){ .card{margin-top:clamp(280px,62vh,420px)} }
    @media (min-width:1024px){
      body{background-position:center 32%}
      .card{margin-top:clamp(300px,68vh,520px)}
    }
    @media (min-aspect-ratio:16/10) and (min-width:1200px){ .card{margin-top:clamp(340px,72vh,560px)} }

    /* Effects */
    @keyframes fade-in{from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:translateY(0)}}
    @keyframes shimmer{from{background-position:-200% 0} to{background-position:200% 0}}
    @media (prefers-reduced-motion:reduce){ .card,.explain{animation:none} }
  </style>
</head>
<body>
  <header>
    <h1 aria-label="Daily Scripture">Daily Scripture</h1>

    <!-- Search -->
    <div class="search-wrap">
      <input id="q" class="search" type="search" placeholder="Search: John 3:16 or words like â€˜shepherd peaceâ€™â€¦  (Press / to focus)" autocomplete="off" />
      <div id="results" class="results" role="listbox" aria-label="Search results"></div>
    </div>

    <div class="btns">
      <label class="toggle" title="Auto-speak on page load">
        <input id="autoSpeak" type="checkbox" checked />
        Auto-speak
      </label>
      <button id="againBtn" aria-label="Another verse" title="R">âŸ³ Another</button>
      <button id="speakBtn" aria-label="Replay" title="S">ðŸ”Š Replay</button>
    </div>
  </header>

  <main>
    <!-- Main verse -->
    <section class="card" aria-live="polite">
      <div class="ref" id="ref">Loadingâ€¦</div>
      <div id="text" class="text skeleton" aria-busy="true"></div>
      <p class="tip" id="tip">Tip: press <strong>R</strong> for another verse, <strong>S</strong> to replay.</p>
    </section>

    <!-- Explanation -->
    <section class="explain" id="explainBox" hidden>
      <div class="label">What this means</div>
      <div class="content" id="explainText"></div>
    </section>
  </main>

  <script>
    /* ===================== Scriptures + explanations ===================== */
    const SCRIPTURES = [
      { book:"John",chapter:"3",verse:"16",text:"For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.",explain:"God loves the world so much that He gave Jesus for us. Anyone who trusts in Him is saved and receives eternal life."},
      { book:"Psalms",chapter:"23",verse:"4",text:"Yea, though I walk through the valley of the shadow of death, I will fear no evil: for thou art with me; thy rod and thy staff they comfort me.",explain:"Even in dark, threatening seasons, I donâ€™t need to fear. God is with me, guiding and protecting me."},
      { book:"Romans",chapter:"8",verse:"28",text:"And we know that all things work together for good to them that love God, to them who are the called according to his purpose.",explain:"For those who love God, He is at work in every situationâ€”good or badâ€”bringing about ultimate good."},
      { book:"Philippians",chapter:"4",verse:"13",text:"I can do all things through Christ which strengtheneth me.",explain:"With Christâ€™s strength, I can face whatever He calls me to; Iâ€™m not relying on my own power."},
      { book:"Jeremiah",chapter:"29",verse:"11",text:"For I know the thoughts that I think toward you, saith the LORD, thoughts of peace, and not of evil, to give you an expected end.",explain:"Godâ€™s heart toward His people is goodâ€”He intends hope, peace, and a future."},
      { book:"Proverbs",chapter:"3",verse:"5",text:"Trust in the LORD with all thine heart; and lean not unto thine own understanding.",explain:"Place full confidence in God rather than depending only on your limited perspective."},
      { book:"Proverbs",chapter:"3",verse:"6",text:"In all thy ways acknowledge him, and he shall direct thy paths.",explain:"Bring God into every part of life; He will guide your steps."},
      { book:"Isaiah",chapter:"41",verse:"10",text:"Fear thou not; for I am with thee: be not dismayed; for I am thy God: I will strengthen thee; yea, I will help thee; yea, I will uphold thee with the right hand of my righteousness.",explain:"Do not be afraidâ€”God is present, strengthening, helping, and holding you up."},
      { book:"Matthew",chapter:"11",verse:"28",text:"Come unto me, all ye that labour and are heavy laden, and I will give you rest.",explain:"Jesus invites the weary and burdened to come to Him and find true rest."},
      { book:"Joshua",chapter:"1",verse:"9",text:"Have not I commanded thee? Be strong and of a good courage; be not afraid, neither be thou dismayed: for the LORD thy God is with thee whithersoever thou goest.",explain:"Be strong and courageous, not fearfulâ€”God is with you everywhere you go."}
    ];

    /* ===================== Helpers ===================== */
    const byRef = v => `${v.book} ${v.chapter}:${v.verse}`;
    const pickRandom = a => a[Math.floor(Math.random()*a.length)];
    const $ = sel => document.querySelector(sel);

    // Flexible "John 3:16" parsing with common abbreviations
    const BOOK_ALIASES = {
      'ps':'Psalms','psa':'Psalms','psalm':'Psalms','psalms':'Psalms',
      'jn':'John','jhn':'John','john':'John',
      'prov':'Proverbs','pr':'Proverbs',
      'rom':'Romans','rm':'Romans',
      'phil':'Philippians','php':'Philippians',
      'isa':'Isaiah',
      'jer':'Jeremiah',
      'josh':'Joshua'
    };
    function parseRefQuery(s){
      const m = s.trim().match(/^([1-3]?\s*[A-Za-z\.]+)\s+(\d+):(\d+)$/);
      if(!m) return null;
      const raw = m[1].replace(/\./g,'').toLowerCase();
      const book = BOOK_ALIASES[raw] || m[1].replace(/\s+/g,' ').trim();
      return { book, chapter:m[2], verse:m[3] };
    }

    // Highlight matches in a snippet
    function hi(text, terms){
      let out = text;
      terms.forEach(t=>{
        const re = new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'ig');
        out = out.replace(re,'<mark>$1</mark>');
      });
      return out;
    }

    /* ===================== Speech (US female) ===================== */
    const PREFERRED_NAMES = ['Samantha','Google US English','Microsoft Aria','Microsoft Jenny','Microsoft Zira','Allison','Joanna'];
    let chosenVoice = null;

    function pickVoice(){
      const voices = window.speechSynthesis.getVoices() || [];
      for(const name of PREFERRED_NAMES){
        const v = voices.find(v => (v.name||'').toLowerCase().includes(name.toLowerCase()) &&
                                   (v.lang||'').toLowerCase().startsWith('en-us'));
        if(v) return v;
      }
      return voices.find(v => (v.lang||'').toLowerCase().startsWith('en-us')) || voices[0] || null;
    }
    function ensureVoices(){
      const tryLoad = () => {
        const list = window.speechSynthesis.getVoices();
        if(!list || list.length===0) return false;
        chosenVoice = pickVoice(); return true;
      };
      if(!tryLoad()){
        const iv = setInterval(()=>{ if(tryLoad()) clearInterval(iv); },120);
        window.speechSynthesis.onvoiceschanged = ()=>{ if(tryLoad()) window.speechSynthesis.onvoiceschanged=null; };
      }
    }
    function speak(text){
      if(!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'en-US'; u.rate = 0.96; u.pitch = 1.03;
      if(chosenVoice) u.voice = chosenVoice;
      window.speechSynthesis.speak(u);
    }

    /* ===================== Page logic ===================== */
    let current = null;

    function showVerse(v){
      $('#ref').textContent = byRef(v);
      const textEl = $('#text');
      textEl.classList.remove('skeleton'); textEl.removeAttribute('aria-busy');
      textEl.textContent = v.text;

      $('#explainText').textContent = v.explain || 'Explanation coming soon.';
      $('#explainBox').hidden = false;
      current = v;

      const auto = $('#autoSpeak').checked;
      if(auto){
        setTimeout(()=>{
          if(!chosenVoice) ensureVoices();
          speak(v.text);
        }, 150);
      }
    }

    function rollRandom(){
      showVerse(pickRandom(SCRIPTURES));
      history.replaceState(null,'','#');
    }

    /* ===================== Search ===================== */
    const q = $('#q');
    const results = $('#results');
    let activeIndex = -1;

    function clearResults(){ results.innerHTML=''; results.classList.remove('show'); activeIndex=-1; }
    function renderResults(items, terms){
      results.innerHTML = '';
      items.slice(0,30).forEach((v,i)=>{
        const div = document.createElement('div');
        div.className='hit'; div.dataset.index=i; div.setAttribute('role','option');
        div.innerHTML = `
          <div class="ref">${byRef(v)}</div>
          <div class="snippet">${hi(v.text, terms)}</div>`;
        div.addEventListener('click', ()=>{ clearResults(); showVerse(v); q.blur(); });
        results.appendChild(div);
      });
      results.classList.toggle('show', items.length>0);
      activeIndex = -1;
    }
    function searchVerses(query){
      const refQ = parseRefQuery(query);
      if(refQ){
        const v = SCRIPTURES.find(s =>
          s.book.toLowerCase()===refQ.book.toLowerCase() &&
          s.chapter===String(refQ.chapter) && s.verse===String(refQ.verse)
        );
        return { items: v?[v]:[], terms: [] };
      }
      const terms = query.toLowerCase().trim().split(/\s+/).filter(Boolean);
      if(!terms.length) return { items: [], terms: [] };
      const items = SCRIPTURES.filter(v=>{
        const hay = (byRef(v)+' '+v.text+' '+(v.explain||'')).toLowerCase();
        return terms.every(t => hay.includes(t));
      });
      return { items, terms };
    }
    function onQueryInput(){
      const query = q.value.trim();
      if(query.length<2){ clearResults(); return; }
      const {items, terms} = searchVerses(query);
      renderResults(items, terms);
    }

    q.addEventListener('input', onQueryInput);
    q.addEventListener('focus', onQueryInput);
    q.addEventListener('keydown', e=>{
      const items = Array.from(results.querySelectorAll('.hit'));
      if(!items.length) return;
      if(e.key==='ArrowDown'){ e.preventDefault(); activeIndex = (activeIndex+1)%items.length; }
      else if(e.key==='ArrowUp'){ e.preventDefault(); activeIndex = (activeIndex-1+items.length)%items.length; }
      else if(e.key==='Enter'){ e.preventDefault(); (items[activeIndex] || items[0])?.click(); }
      else if(e.key==='Escape'){ clearResults(); q.blur(); }
      items.forEach(el=>el.classList.remove('active'));
      if(activeIndex>=0) items[activeIndex].classList.add('active');
    });
    document.addEventListener('click', e=>{
      if(!results.contains(e.target) && e.target!==q) clearResults();
    });

    /* ===================== Shortcuts & Init ===================== */
    // Keyboard shortcuts
    window.addEventListener('keydown', e=>{
      if(e.key==='/' && document.activeElement!==q){ e.preventDefault(); q.focus(); q.select(); }
      if(e.key.toLowerCase()==='r'){ rollRandom(); }
      if(e.key.toLowerCase()==='s'){ current && speak(current.text); }
    });

    // Persist auto-speak preference
    const saved = localStorage.getItem('autoSpeak');
    if(saved!==null) $('#autoSpeak').checked = saved==='1';
    $('#autoSpeak').addEventListener('change', ()=> localStorage.setItem('autoSpeak', $('#autoSpeak').checked ? '1':'0'));

    // Init
    ensureVoices();
    rollRandom();

    // Friendly tip if speech is blocked by browser policy
    setTimeout(()=>{
      if(speechSynthesis && speechSynthesis.pending===false && $('#autoSpeak').checked){
        // If nothing has spoken yet, keep the tip visible; else remove it on replay.
      }
      $('#speakBtn').addEventListener('click', ()=> $('#tip').style.display='none');
    },700);

    // Buttons
    $('#againBtn').addEventListener('click', rollRandom);
    $('#speakBtn').addEventListener('click', ()=> current && speak(current.text));
  </script>
</body>
</html>
